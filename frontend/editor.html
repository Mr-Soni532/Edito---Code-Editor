<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./styles/editor.css">
    <!-- External icon links -->
    <script src="https://kit.fontawesome.com/f584623432.js" crossorigin="anonymous"></script>
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>

    <!-- codemirror liberies css & script -->
    <script src="./codemirror/lib/codemirror.js"></script>
    <link rel="stylesheet" href="./codemirror/lib/codemirror.css">

    <!-- for mode ===== here is for javascript only -->
    <script src="./codemirror/mode/xml/xml.js"></script>
    <script src="./codemirror/mode/css/css.js"></script>
    <script src="./codemirror/mode/javascript/javascript.js"></script>

    <!-- codemirror theme -->
    <link rel="stylesheet" href="./codemirror/theme/ayu-dark.css">

    <!-- some addons -->
    <script src="./codemirror/addon/edit/closetag.js"></script>
    <script src="./codemirror/addon/edit/closebrackets.js"></script>
    <script src="./codemirror/addon/scroll/simplescrollbars.js"></script>
    <script src="./codemirror/addon/hint/show-hint.js"></script>
    <script src="./codemirror/addon/hint/show-hint.js"></script>
    <script src="./codemirror/addon/hint/css-hint.js"></script>
    <script src="./codemirror/addon/hint/html-hint.js"></script>
    <script src="./codemirror/addon/hint/javascript-hint.js"></script>
    <link rel="stylesheet" href="./codemirror/addon/hint/show-hint.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.0.0/split.min.js"
        integrity="sha512-tTsZnBXEzNdEaqUO9Ok8fUofS73xieiBa54pD/sxOSvayIgItM9MmEM0CnUjA13LDnJT22sfwmjf20+Bo2174g=="
        crossorigin="anonymous"></script>
    <title>Edito - Online Text Editor</title>
    <link rel="stylesheet" href="./styles/main_section.css">

    <!-- ----------Socket cdn------------ -->
    <script
    src="https://cdn.socket.io/3.1.3/socket.io.min.js"
    integrity="sha384-cPwlPLvBTa3sKAgddT6krw0cJat7egBga3DJepJyrLl4Q9/5WLra3rrnMcyTyOnh"
    crossorigin="anonymous"
  ></script>
  <!-- ========alert======== -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
    <nav>
        <div id="nav_logo">
            <i class='bx bxl-c-plus-plus icon' style="font-size: 30px; color: white;"></i>
        </div>

       
        <div class="nav_search-bar">
            <div id="controller">
                <i class="fa-solid fa-arrow-left"></i>
                <i class="fa-solid fa-arrow-right" style="color: rgb(110, 110, 110);"></i>
            </div>
            <div id="searchBar">
                <i class="fa-solid fa-magnifying-glass"></i>Folder Name
            </div>
        </div>
        <div class="dropdown">
            <div class="dropbtn">View <span><img src="./resources/svg/down.svg" alt=""></span></div>
            <div class="dropdown-content">
              <a id="nav_layout-1">Layout 1</a>
              <a id="nav_layout-2">Layout 2</a>
              <a id="nav_layout-3">Layout 3</a>
            </div>
          </div>
       

    </nav>

    <div class="sidebar">
        <div class="logo-details">
            <!-- <i class='bx bxl-c-plus-plus icon'></i> -->
            <div class="logo_name">Edito</div>
            <i class='bx bx-menu' id="btn"></i>
        </div>
        <ul class="nav-list">

            <li>
                <i class='bx bx-search'></i>
                <input type="text" placeholder="Search...">
                <span class="tooltip">Search</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bx-folder'></i>
                    <span class="links_name">Explorer</span>
                </a>
                <span class="tooltip">Explorer</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bx-grid-alt'></i>
                    <span class="links_name">Extensions</span>
                </a>
                <span class="tooltip">Extensions</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bx-user'></i>
                    <span class="links_name">User</span>
                </a>
                <span class="tooltip">User</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bx-chat'></i>
                    <span class="links_name">Messages</span>
                </a>
                <span class="tooltip">Messages</span>
            </li>

            <li>
                <a href="#">
                    <i class='bx bx-cog'></i>
                    <span class="links_name">Setting</span>
                </a>
                <span class="tooltip">Setting</span>
            </li>
            <li class="profile">
                <div class="profile-details">
                    <!-- <img src="profile.jpg" alt="profileImg"> -->
                    <div class="name_job">
                        <div class="name">User Name</div>
                        <div class="job">Web designer</div>
                    </div>
                </div>
                <i class='bx bx-log-out' id="log_out"></i>
            </li>
        </ul>
    </div>
    <!-- <section class="home-section">
        <div class="text split">
            <textarea id="htmlCode" placeholder="Type HTML code here" onkeyup="update()"></textarea>
            <textarea id="cssCode" placeholder="Type CSS code here" onkeyup="update()"></textarea>
            <textarea id="javascriptCode" placeholder="Type JavaScript code here" onkeyup="update()"></textarea>
        </div>
        <div class="iframe-container split">
            <iframe id="viewer"></iframe>
        </div>
    </section> -->

    <!-- <section class="main_section" id="main_section">
        <div class="resizable-x">
            <div class="resizable-y" style="flex: 50%;">
                <div class="html_editor" style="height: 33.33%;min-height: 50px;">
                    <textarea id="htmlCode" placeholder="Type HTML code here" ></textarea>
                </div>
                <div class="resizer-y resizer-y-1"></div>
                <div class="css_editor" style="height: 33.33%;min-height: 50px;">
                    <textarea id="cssCode" placeholder="Type CSS code here" ></textarea>
                </div>
                <div class="resizer-y resizer-y-2"></div>
                <div class="js_editor" style="height: 33.33%;min-height: 50px;">
                    <textarea id="javascriptCode" placeholder="Type JavaScript code here" ></textarea>
                </div>
            </div>
            <div class="resizer-x"></div>
            <div class="output_iframe_section" style="flex: 50%;">
                <iframe id="viewer"></iframe>
            </div>
        </div>
    </section> -->

    <!-- <section class="main_section layout_2" id="main_section">
        <div class="resizable-x">
            <div class="output_iframe_section" style="flex: 50%;">
                <iframe id="viewer"></iframe>
            </div>
            <div class="resizer-x"></div>
            <div class="resizable-y" style="flex: 50%;">
                <div class="html_editor" style="height: 33.33%;min-height: 50px;">
                    <div class="resizer-y html">HTML</div>
                    <textarea id="htmlCode" placeholder="Type HTML code here"></textarea>
                </div>
                <div class="css_editor" style="height: 33.33%;min-height: 50px;">
                    <div class="resizer-y resizer-y-1 css">CSS</div>
                    <textarea id="cssCode" placeholder="Type CSS code here"></textarea>
                </div>
                <div class="js_editor" style="height: 33.33%;min-height: 50px;">
                    <div class="resizer-y resizer-y-2 js">JS</div>
                    <textarea id="javascriptCode" placeholder="Type JavaScript code here"></textarea>
                </div>
            </div>
        </div>
    </section> -->
    <!-- <section class="main_section layout_2" id="main_section">
        <div class="resizable-x">
            <div class="output_iframe_section" style="flex: 50%;">
                <iframe id="viewer"></iframe>
            </div>
            <div class="resizer-x"></div>
            <div class="resizable-y" style="flex: 50%;">
                <div class="html_editor" style="height: 33.33%;min-height: 50px;">
                    <div class="resizer-y html">HTML</div>
                    <textarea id="htmlCode" placeholder="Type HTML code here"></textarea>
                </div>
                <div class="css_editor" style="height: 33.33%;min-height: 50px;">
                    <div class="resizer-y resizer-y-1 css">CSS</div>
                    <textarea id="cssCode" placeholder="Type CSS code here"></textarea>
                </div>
                <div class="js_editor" style="height: 33.33%;min-height: 50px;">
                    <div class="resizer-y resizer-y-2 js">JS</div>
                    <textarea id="javascriptCode" placeholder="Type JavaScript code here"></textarea>
                </div>
            </div>
        </div>
    </section> -->
    <section class="main_section layout_3" id="main_section">
        <div class="resizable-y l-3">
            <div class="output_iframe_section l-3" style="flex: 50%;">
                <iframe id="viewer"></iframe>
            </div>
            <div class="resizer-y l-3"></div>
            <div class="resizable-x l-3" style="flex: 50%; flex-direction: row;">
                <div class="html_editor editor_l-3" style="height: 100%;min-height: 50px;width: 33.33%;">
                    <div>
                        <div class="resizer-x l-3 html">HTML</div>
                        <textarea id="htmlCode" placeholder="Type HTML code here"></textarea>
                    </div>
                    <span></span>
                </div>
                <div class="css_editor editor_l-3" style="height: 100%;min-height: 50px;width: 33.33%;">
                    <div>
                        <div class="resizer-x l-3 resizer-y_l-3_1 css ">CSS</div>
                        <textarea id="cssCode" placeholder="Type CSS code here"></textarea>
                    </div>
                    <span></span>
                </div>
                <div class="js_editor editor_l-3" style="height: 100%;min-height: 50px;width: 33.33%;">
                    <div>
                        <div class="resizer-x l-3 resizer-y_l-3_2 js">JS</div>
                        <textarea id="javascriptCode" placeholder="Type JavaScript code here"></textarea>
                    </div>
                    <span></span>
                </div>
            </div>
        </div>
    </section>
</body>

</html>


<script>


    let sidebar = document.querySelector(".sidebar");
    let closeBtn = document.querySelector("#btn");
    let searchBtn = document.querySelector(".bx-search");

    closeBtn.addEventListener("click", () => {
        sidebar.classList.toggle("open");
        menuBtnChange();//calling the function(optional)
    });

    searchBtn.addEventListener("click", () => { // Sidebar open when you click on the search iocn
        sidebar.classList.toggle("open");
        menuBtnChange(); //calling the function(optional)
    });

    // following are the code to change sidebar button(optional)
    function menuBtnChange() {
        if (sidebar.classList.contains("open")) {
            closeBtn.classList.replace("bx-menu", "bx-menu-alt-right");//replacing the iocns class
        } else {
            closeBtn.classList.replace("bx-menu-alt-right", "bx-menu");//replacing the iocns class
        }
    }




    // CodeMirror Code ==========>>>>>>>>>>>>>>>>
    var editorHTML = CodeMirror.fromTextArea(document.getElementById('htmlCode'), {
        mode: 'xml',
        theme: "ayu-dark",
        lineNumbers: true,
        autoCloseTags: true,
        autoCloseBrackets: true,
        lineWrapping: true,
        scrollbarStyle: 'native',
        undoDepth: 100,
        extraKeys: { "Ctrl-Space": "autocomplete" }
    })


    var editorCSS = CodeMirror.fromTextArea(document.getElementById('cssCode'), {
        mode: 'css',
        theme: "ayu-dark",
        lineNumbers: true,
        autoCloseTags: true,
        autoCloseBrackets: true,
        lineWrapping: true,
        scrollbarStyle: 'native',
        undoDepth: 100,
        extraKeys: { "Ctrl-Space": "autocomplete" }
    })

    var editorJS = CodeMirror.fromTextArea(document.getElementById('javascriptCode'), {
        mode: 'javascript',
        theme: "ayu-dark",
        lineNumbers: true,
        autoCloseTags: true,
        autoCloseBrackets: true,
        lineWrapping: true,
        scrollbarStyle: 'native',
        undoDepth: 100,
        extraKeys: { "Ctrl-Space": "autocomplete" }
    })



    let htmlEditor = "";
    let cssEditor = "";
    let jsEditor = "";

    editorHTML.on("keyup", (editor) => {
    htmlEditor = editor.doc.getValue();
    codeEmithtml(htmlEditor);
    update();
  });
  editorCSS.on("keyup", (editor) => {
    cssEditor = editor.doc.getValue();
    codeEmitcss(cssEditor);
    update();
  });
  editorJS.on("keyup", (editor) => {
    jsEditor = editor.doc.getValue();
    codeEmitjs(jsEditor);
    update();
  });


    function update() {
        let text = htmlEditor + "<style>" + cssEditor + "</style>" + "<scri" + "pt>" + jsEditor + "</scri" + "pt>";
        console.log(htmlEditor, cssEditor, jsEditor)
        let iframe = document.getElementById('viewer').contentWindow.document;
        iframe.open();
        iframe.write(`${text}`);
        iframe.close();
        let srcDoc;


        iframe.srcdoc = srcDoc;
    }

     //------------ Socket.io --------------
  const urlParams = new URLSearchParams(window.location.search);

const username = urlParams.get("username");
const room_id = urlParams.get("editioID");
const socket = io("http://localhost:3000/", { transports: ["websocket"] });

console.log(username, room_id);

socket.emit("join", { username, room_id });

function codeEmithtml(code) {
  socket.emit("code_change_html", { room_id, code });
}
function codeEmitcss(code) {
  socket.emit("code_change_css", { room_id, code });
}
function codeEmitjs(code) {
  socket.emit("code_change_js", { room_id, code });
}

socket.on("code_change_html", ({ code }) => {
  console.log("html" + code);
  editorHTML.getDoc().setValue(code);
  htmlEditor = code;
  update();
});
socket.on("code_change_css", ({ code }) => {
  console.log("css" + code);
  editorCSS.getDoc().setValue(code);
  cssEditor = code;
  update();
});
socket.on("code_change_js", ({ code }) => {
  console.log("js" + code);
  editorJS.getDoc().setValue(code);
  jsEditor = code;
  update();
});

socket.on("join", ({ username }) => {
  console.log(username);
  Swal.fire({
    position: "top-end",
    title: `${username} has joined`,
    showConfirmButton: false,
    timer: 3000,
  });
});

</script>
<script src="./scripts/main_section.js"></script>